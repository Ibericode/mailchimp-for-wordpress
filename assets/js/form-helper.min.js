var FormHelper=function(){"use strict";function a(a){var b=a.keyCode||a.which;if(9==b){a.preventDefault();var d=this.selectionStart,e=this.selectionEnd;c(this).val(c(this).val().substring(0,d)+"	"+c(this).val().substring(e)),this.selectionStart=this.selectionEnd=d+1}}function b(a){for(var b=c("<div />").html(c(this).val()),d=b.find("[required]"),e=[],f=0;f<d.length;f++)e.push(d[f].name);g.val(e.join(","))}var c=window.jQuery,d=c(document.getElementById("content")),e=c(document.getElementById("missing-fields-notice")),f=c(document.getElementById("missing-fields-list")),g=c(document.getElementById("input-required-fields"));c(document.body).delegate("#content","keydown",a),c(document.body).delegate("#content","change",b),function(){function a(){f.is(":checked")?e.hide():e.text("Select at least 1 list this form should subscribe people to.").show()}function b(a,b,d){var e=""===c(a).val()?c(a).data("inherited-value"):c(a).val(),f=1==e==d;f?c("#mc4wp-"+b).removeClass("hidden").find(":input").removeAttr("disabled"):c("#mc4wp-"+b).addClass("hidden").find(":input").attr("disabled","disabled")}var d=c(document.getElementById("mc4wp-form-settings")),e=d.find(".mc4wp-notice"),f=c(document.getElementById("mc4wp-lists")).find(":input"),g=c("input[name='mc4wp_form[double_optin]']"),h=c('input[name="mc4wp_form[update_existing]"]');f.change(a),g.change(function(){b(this,"send-welcome",!1)}),h.change(function(){b(this,"replace-interests",!0)}),c('#mc4wp-optional-settings input[name="mc4wp_form[send_email_copy]"]').change(function(){c("#email_copy_receiver").toggle(1==c(this).val())}),a()}(),function(){function a(){for(var a={},b=0;b<H.length;b++){var g='name="'+H[b].tag.toLowerCase();-1==d.val().toLowerCase().indexOf(g)&&(a[H[b].tag]=H[b])}if(c.isEmptyObject(a))return void e.hide();f.html("");for(var h in a){var i=a[h],j=c("<li />");j.html(i.name+" (<code>"+i.tag+"</code>)"),j.appendTo(f)}e.show()}function b(){u.find("option").not(".default").remove(),H=[],t.filter(":checked").each(function(){for(var a=c(this).val(),b=mc4wp.mailchimpLists[a],d=0,e=b.merge_vars.length;e>d;d++){var f=b.merge_vars[d];if(f.req&&H.push(f),0==v.find("option[value='"+f.tag+"']").length){var g=f.name.length>25?f.name.substring(0,25)+"..":f.name;f.req&&(g+="*");var h=c("<option />").text(g).val(f.tag).data("list-field",f);v.append(h)}}for(var d=0,i=b.interest_groupings.length;i>d;d++){var j=b.interest_groupings[d];if(0==w.find("option[value='"+j.id+"']").length){var g=j.name.length>25?j.name.substring(0,25)+"..":j.name,h=c("<option />").text(g).val(j.id).data("list-grouping",j);w.append(h)}}}),a()}function g(){h();var a=c(this).find(":selected");switch(a.val()){case"submit":r="submit",z.text(G.buttonText),y.val(G.subscribe),x.find("p.row").filter(".value, .wrap-p").show();break;case"_lists":r="lists",x.find(".wrap-p").show();break;case"_action":r="action",x.find(".wrap-p").show();break;default:var b=a.data("list-field");if(b)return m(b);var b=a.data("list-grouping");if(b)return j(b)}o()}function h(){x.find(".row :input").each(function(){c(this).is(":checkbox")?this.checked=!0:this.value=""}),x.find("p.row").hide(),A.find(":input").remove(),x.show(),r="text",s="",z.html(G.initialValue+" <small>"+G.optional+"</small>")}function i(a){for(var b=0,d=a.length;d>b;b++)c("<input />").attr("type","text").addClass("widefat").data("value",a[b].name).attr("placeholder",G.labelFor+' "'+a[b].name+'" '+G.orLeaveEmpty).attr("value",a[b].name).appendTo(A)}function j(a){switch(x.find("p.row").filter(".values, .label, .wrap-p").show(),B.val(a.name+":"),s="GROUPINGS["+a.id+"]",i(a.groups),a.form_field){case"radio":r="radio";break;case"hidden":x.find("p.row").filter(".values, .label, .wrap-p").hide(),x.find("p.row.value").show();for(var b=0,c=a.groups.length;c>b;b++)y.val(y.val()+a.groups[b].name+",");r="hidden";break;case"dropdown":r="select";break;default:r="checkbox",s+="[]"}o()}function k(){for(var a=[{name:"subscribe",label:G.subscribe,checked:!0},{name:"unsubscribe",label:G.unsubscribe,checked:!1}],b="",c=0;c<a.length;c++){var d=a[c];b+="<label>\n",b+='	<input type="radio" name="_mc4wp_action" value="'+d.name+'" '+(d.checked?"checked":"")+" > "+d.label+"\n",b+="</label>\n"}return b}function l(){var a="";return t.each(function(){var b=c(this).val(),d=c(this).parent("label").text(),e="";c(this).is(":checked")&&(e+="checked "),a+="<label>\n",a+='	<input type="checkbox" name="_mc4wp_lists[]" value="'+b+'" '+e+" /> "+d+"\n",a+="</label>\n"}),a}function m(a){var b={"default":["label","value","placeholder","required","wrap-p"],select:["label","required","wrap-p","values"],radio:["label","required","wrap-p","values"],date:["label","required","wrap-p","value"]},d={text:"text",email:"email",phone:"tel",address:"text",number:"number",dropdown:"select",date:"date",birthday:"date",radio:"radio",checkbox:"checkbox"};if(r=void 0!=d[a.field_type]?d[a.field_type]:"text",void 0!=b[r])var e=b[r];else var e=b["default"];for(var f=0,g=e.length;g>f;f++)x.find("p.row."+e[f]).show();if(r=r,s=a.tag,C.val("Your "+a.name.toLowerCase()),B.val(a.name+":"),D.prop("checked",a.req),A.is(":visible")&&a.choices)for(var f=0,g=a.choices.length;g>f;f++)c("<input />").attr("type","text").addClass("widefat").data("value",a.choices[f]).attr("placeholder",G.labelFor+' "'+a.choices[f]+'" '+G.orLeaveEmpty).attr("value",a.choices[f]).appendTo(A);o()}function n(a){a=html_beautify(a),F.val(a)}function o(){var a,b=c("<div></div>"),d="";switch(r){case"action":return d=k(),q()&&(d="<p>"+d+"</p>"),n(d);case"lists":return d=l(),q()&&(d="<p>"+d+"</p>"),n(d);case"select":a=c("<select />"),A.find(":input").each(function(){c(this).val().length>0&&c("<option />").val(c(this).data("value")).text(c(this).val()).appendTo(a)});break;case"radio":case"checkbox":A.find(":input").each(function(){c(this).val().length>0&&(a=c("<input />").attr("type",r).attr("name",s).val(c(this).data("value")),D.is(":visible:checked")&&a.attr("required",!0),b.append(a),a.wrap("<label />"),c("<span />").text(c(this).val()+" ").insertAfter(a))});break;case"textarea":a=c("<textarea />");break;default:a=c("<input />").attr("type",r)}"radio"!=r&&"checkbox"!=r&&(s.length>0&&a.attr("name",s),y.is(":visible")&&y.val().length>0&&("textarea"==r?a.text(y.val()):a.attr("value",y.val())),C.is(":visible")&&C.val().length>0&&a.attr("placeholder",C.val()),D.is(":visible:checked")&&a.attr("required",!0),b.append(a)),B.is(":visible")&&B.val().length>0&&c("<label />").text(B.val()).prependTo(b),q()&&b.wrapInner(c("<p />")),d=b.html(),n(d)}function p(){var a=!1;"undefined"!=typeof wpActiveEditor&&"undefined"!=typeof QTags&&QTags.insertContent&&(a=QTags.insertContent(F.val())),a||d.val(d.val()+"\n"+F.val()),d.change()}function q(){return E.is(":visible:checked")?!0:!1}var r,s,t=c("#mc4wp-lists input"),u=c("#mc4wp-fw-mailchimp-fields"),v=u.find(".merge-fields"),w=u.find(".groupings"),x=c("#mc4wp-fw-fields"),y=c("#mc4wp-fw-value"),z=c("#mc4wp-fw-value-label"),A=c("#mc4wp-fw-values"),B=c("#mc4wp-fw-label"),C=c("#mc4wp-fw-placeholder"),D=c("#mc4wp-fw-required"),E=c("#mc4wp-fw-wrap-p"),F=c("#mc4wp-fw-preview"),G=mc4wp.strings.fieldWizard,H=[];t.change(b),u.change(g),x.change(o),c("#mc4wp-fw-add-to-form").click(p),d.bind({input:function(){d.unbind("keydown"),a.call(this)},keydown:a}),b()}()};